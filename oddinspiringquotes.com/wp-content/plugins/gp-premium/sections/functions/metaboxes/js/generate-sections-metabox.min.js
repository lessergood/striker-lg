/*!  1.0.0 2016-08-06 16:26 */
var Generate_Sections={backbone_modal:{__instance:void 0}};!function(a,b){b.Section=Backbone.Model.extend({defaults:{title:"",box_type:"",inner_box_type:"",custom_classes:"",top_padding:"",bottom_padding:"",background_color:"",background_image:"",background_image_preview:"",parallax_effect:"",text_color:"",link_color:"",link_color_hover:"",content:""}}),b.SectionsCollection=Backbone.Collection.extend({model:b.Section,el:"#generate_sections_container",comparator:function(a){return a.get("index")}}),b.backbone_modal.Application=Backbone.View.extend({attributes:{id:"generate-sections-modal-dialog",class:"generate-sections-modal",role:"dialog"},template:wp.template("generate-sections-modal-window"),mediaUploader:null,tmc_settings:{},tmc_defaults:{theme:"modern",menubar:!1,wpautop:!0,indent:!1,toolbar1:"bold,italic,underline,blockquote,strikethrough,bullist,numlist,alignleft,aligncenter,alignright,undo,redo,link,unlink,fullscreen",plugins:"fullscreen,image,wordpress,wpeditimage,wplink",max_height:500},qt_settings:{},qt_defaults:{buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,fullscreen"},model:b.Section,events:{"click .media-modal-backdrop, .media-modal-close, .media-button-close":"closeModal","click .media-button-insert":"saveModal","click .media-menu-item":"switchTab",keydown:"keydown","click .generate-sections-upload-button":"openMediaUploader","click .generate-sections-remove-image":"removeImage","click div.media-frame-title h1":"toggleMenu"},ui:{nav:void 0,content:void 0},initialize:function(){_.bindAll(this,"render","closeModal","saveModal","switchTab"),this.focusManager=new wp.media.view.FocusManager({el:this.el}),this.changeInsertText(),this.tinyMCEsettings(),this.render()},changeInsertText:function(a){var a="undefined"!=typeof a&&1==a;0==a&&"undefined"!=typeof wp.media.view.l10n.insertIntoPost?(this.insertIntoPost=wp.media.view.l10n.insertIntoPost,wp.media.view.l10n.insertIntoPost=generate_sections_metabox_i18n.insert_into_section):1==a&&"undefined"!=typeof this.insertIntoPost&&(wp.media.view.l10n.insertIntoPost=this.insertIntoPost)},tinyMCEsettings:function(){var b="object"==typeof tinyMCEPreInit&&"mceInit"in tinyMCEPreInit&&"content"in tinyMCEPreInit.mceInit?tinyMCEPreInit.mceInit.content:this.tmc_defaults,c="object"==typeof tinyMCEPreInit&&"qtInit"in tinyMCEPreInit&&"content"in tinyMCEPreInit.qtInit?tinyMCEPreInit.qtInit.content:this.qt_defaults,d={selector:"#generate-sections-editor",wp_autoresize_on:!1,cache_suffix:"",min_height:300};this.tmc_settings=a.extend({},b,d),this.qt_settings=a.extend({},c,{id:"generate-sections-editor"})},render:function(){"use strict";return this.$el.attr("tabindex","0").html(this.template),jQuery("body").addClass("generate-modal-open").prepend(this.$el),jQuery("#wpwrap").attr("aria-hidden","true"),this.renderContent(),this.renderPreview(),this.selected(),this.colorPicker(),this.startTinyMCE(),this.$el.focus(),this},toggleMenu:function(){this.$el.find(".media-menu").toggleClass("visible")},renderContent:function(){var b=this.model,c=wp.template("generate-sections-modal-menu-item");if(this.ui.nav=this.$el.find(".media-menu"),this.ui.panels=this.$el.find(".media-frame-content"),generate_sections_metabox_i18n.tabs.length)for(var d in generate_sections_metabox_i18n.tabs)if(generate_sections_metabox_i18n.tabs.hasOwnProperty(d)){d=generate_sections_metabox_i18n.tabs[d];var e=a(c({target:d.target,name:d.title})),f=wp.template("generate-sections-edit-"+d.target),g=a(f(b.toJSON()));"true"==d.active&&(e.addClass("active"),g.addClass("active")),this.ui.nav.append(e),this.ui.panels.append(g)}},renderPreview:function(b){var b="undefined"!=typeof b?b:this.model.get("background_image"),c=a("#generate-section-image-preview");c.children().remove(),b>0&&(this.background=new wp.media.model.Attachment.get(b),this.background.fetch({success:function(b){_.contains(["png","jpg","gif","jpeg"],b.get("subtype"))&&(a("<img/>").attr("src",b.attributes.sizes.thumbnail.url).appendTo(c),c.next().find(".generate-sections-remove-image").show())}}))},selected:function(){var a=this;this.$el.find("select").each(function(b,c){var d=jQuery(c).attr("name"),e=a.model.get(d);jQuery(c).val(e)})},colorPicker:function(){this.$el.find(".generate-sections-color").wpColorPicker()},startTinyMCE:function(){this.ui.panels.find("#wp-generate-sections-editor-wrap").addClass(generate_sections_metabox_i18n.default_editor),generate_sections_metabox_i18n.user_can_richedit||this.ui.panels.find(".wp-editor-tabs").remove(),"object"==typeof tinyMCEPreInit&&(tinyMCEPreInit.mceInit["generate-sections-editor"]=this.tmc_settings,tinyMCEPreInit.qtInit["generate-sections-editor"]=this.qt_settings);try{var a="undefined"!=typeof tinyMCE;quicktags(this.qt_settings),QTags._buttonsInit(),a!==!1&&tinyMCE.init(this.tmc_settings)}catch(a){}},openMediaUploader:function(a){var b=this;return $input=jQuery(a.currentTarget).prev("#generate-sections-background-image"),a.preventDefault(),this.mediaUploader?void this.mediaUploader.open():(this.mediaUploader=wp.media.frames.file_frame=wp.media({title:generate_sections_metabox_i18n.media_library_title,button:{text:generate_sections_metabox_i18n.media_library_button},multiple:!1}),this.mediaUploader.on("select",function(){attachment=this.mediaUploader.state().get("selection").first().toJSON(),$input.val(attachment.id),b.renderPreview(attachment.id)}),void this.mediaUploader.open())},removeImage:function(b){b.preventDefault(),a("#generate-section-image-preview").children().remove(),a("#generate-section-image-preview").next().find(".generate-sections-remove-image").hide(),a("#generate-sections-background-image").val("")},closeModal:function(a){"use strict";a.preventDefault(),this.undelegateEvents(),jQuery(document).off("focusin"),jQuery("body").removeClass("generate-modal-open"),this.$el.undelegate("keydown"),this.remove(),b.backbone_modal.__instance=void 0,this.mediaUploader=null,b.modalOpen=null,"undefined"!=typeof tinyMCE&&tinymce.EditorManager.execCommand("mceRemoveEditor",!0,"generate-sections-editor"),this.changeInsertText(!0),b.lastFocus.focus(),jQuery("#wpwrap").attr("aria-hidden","false")},saveModal:function(b){"use strict";this.model.get("index");var c=this.model;"undefined"!=typeof tinyMCE&&tinymce.triggerSave();var d=this.ui.panels.find("input, select, textarea");d.each(function(b,d){var e=a(d).attr("name");if(c.attributes.hasOwnProperty(e)){var f=a(d).val();c.set(e,f)}}),this.closeModal(b)},switchTab:function(a){"use strict";a.preventDefault(),this.ui.nav.children().removeClass("active"),this.ui.panels.children().removeClass("active");var b=jQuery(a.currentTarget).addClass("active").data("target");this.ui.panels.find("div[data-id="+b+"]").addClass("active")},keydown:function(a){27===a.which&&this.$el.is(":visible")&&(this.closeModal(a),a.stopImmediatePropagation())}}),b.sectionView=Backbone.View.extend({model:b.Section,tagName:"div",initialize:function(){this.listenTo(this.model,"change",this.maybeRender)},attributes:{class:"ui-state-default section"},template:wp.template("generate-sections-section"),events:{"click .edit-section":"editSection","click .section-title > span":"editSection","click .delete-section":"removeSection","click .toggle-section":"toggleSection",reorder:"reorder"},maybeRender:function(a){this.model.hasChanged("index")||this.render()},render:function(){return this.model.set("index",this.model.collection.indexOf(this.model)),this.$el.html(this.template(this.model.toJSON())),this.model.get("title")||this.$el.find("h3.section-title > span").text(generate_sections_metabox_i18n.default_title),this.$el.find("textarea").val(JSON.stringify(this.model)),this},editSection:function(a){b.lastFocus=document.activeElement,b.modalOpen=!0,a.preventDefault(),void 0===b.backbone_modal.__instance&&(b.backbone_modal.__instance=new b.backbone_modal.Application({model:this.model}))},reorder:function(a,b){this.$el.trigger("update-sort",[this.model,b])},removeSection:function(a){a.preventDefault(),confirm(generate_sections_metabox_i18n.confirm)&&(this.model.destroy(),b.sectionList.render())}}),b.sectionListView=Backbone.View.extend({el:"#generate_sections_container",events:{"update-sort":"updateSort"},addSection:function(a){this.collection.add(a),this.addOne(a)},addOne:function(a){var c=new b.sectionView({model:a});this.$el.append(c.render().el)},render:function(){return this.$el.children().remove(),this.collection.each(this.addOne,this),this},updateSort:function(a,b,c){this.collection.remove(b),this.collection.each(function(a,b){var d=b;b>=c&&(d+=1),a.set("index",d)}),b.set("index",c),this.collection.add(b,{at:c}),this.render()}}),b.ButtonControls=Backbone.View.extend({attributes:{class:"generate_sections_buttons"},tagName:"p",el:"#_generate_sections_metabox",template:wp.template("generate-sections-buttons"),events:{"click .button-primary":"newSection","click #generate-delete-sections":"clearAll","click .edit-section":"editSection"},newSection:function(a){a.preventDefault();var c=new b.Section;b.sectionList.addSection(c)},clearAll:function(a){a.preventDefault(),confirm(generate_sections_metabox_i18n.confirm)&&(b.sectionCollection.reset(),b.sectionList.render())},render:function(){return this.$el.find(".generate_sections_control").append(this.template),this}}),b.initApplication=function(){b.sectionCollection=new b.SectionsCollection(generate_sections_metabox_i18n.sections),b.sectionList=new b.sectionListView({collection:b.sectionCollection}),b.sectionList.render(),b.Buttons=new b.ButtonControls({collection:b.sectionCollection}),b.Buttons.render()},jQuery(document).ready(function(a){function c(){a(".send-to-editor").css("display","none"),a("#postdivrich").css({opacity:"0",height:"0",overflow:"hidden"}),a("#_generate_sections_metabox").css({opacity:"1",height:"auto"}),a("body").trigger("generate_show_sections")}function d(){a(".send-to-editor").css("display","inline-block"),a("#postdivrich").css({opacity:"1",height:"auto"}),a("#_generate_sections_metabox").css({opacity:"0",height:"0",overflow:"hidden"}),a("body").trigger("generate_hide_sections")}b.initApplication(),a("#generate_sections_container").sortable({axis:"y",opacity:.5,grid:[20,10],tolerance:"pointer",handle:".move-section",update:function(a,b){b.item.trigger("reorder",b.item.index())}}),"true"==jQuery("#_generate_use_sections_metabox select").val()?c():d(),jQuery('select[name="_generate_use_sections[use_sections]"]').change(function(){"true"==jQuery(this).val()?c():d()}),jQuery(document).on("click",".send-to-editor",function(b){var c="",d="undefined"!=typeof tinyMCE&&tinyMCE.get("content")&&!tinyMCE.get("content").isHidden();if(!d)return alert(generate_sections_metabox_i18n.use_visual_editor),!1;$sections=a("#generate_sections_container").find(".section");var c="";return $sections.each(function(b){var d=JSON.parse(a(this).find("textarea").val());d.content&&""!==d.content&&(c=c+d.content+"<br/><br/>")}),""!=tinyMCE.get("content").getContent()?(alert(generate_sections_metabox_i18n.no_content_error),!1):(c=c.replace(/\n/gi,"<br>"),tinyMCE.get("content").setContent(c),!1)})})}(jQuery,Generate_Sections);